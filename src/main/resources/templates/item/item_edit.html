<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="'商品編集 - ' + ${item.name}">商品編集</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
  </head>

  <body class="pt-[100px] bg-[var(--main-bg-color)] min-h-screen font-serifjp">
    <div th:replace="fragments/header_user :: header"></div>

    <main class="max-w-3xl mx-auto px-6 py-10">
      <div
        class="bg-white shadow-[0_0_8px_rgba(221,179,142,0.5)] border border-[#eddccc] rounded-3xl p-10 space-y-6"
      >
        <h2 class="text-2xl font-bold text-center mb-6">商品編集</h2>

        <form
          th:action="@{'/items/' + ${item.id} + '/edit'}"
          method="post"
          enctype="multipart/form-data"
          class="space-y-6"
        >
          <div>
            <label for="item_name" class="block font-semibold mb-2"
              >商品名</label
            >
            <input
              type="text"
              id="item_name"
              name="item_name"
              th:value="${item.name}"
              class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              required
            />
          </div>

          <div>
            <label for="price" class="block font-semibold mb-2">価格</label>
            <input
              type="number"
              id="price"
              name="price"
              th:value="${item.price}"
              class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              required
            />
          </div>

          <div>
            <label for="imageFile" class="block font-semibold mb-2"
              >画像アップロード</label
            >
            <input
              type="file"
              id="imageFile"
              name="image_file"
              accept="image/*"
              class="block .primary-button"
            />
            <div class="mt-4 text-center">
              <img
                id="preview"
                th:if="${item.image}"
                th:src="@{'/images/items/' + ${item.image}}"
                alt="プレビュー画像"
                class="hidden mx-auto max-w-[200px] max-h-[200px] rounded-md border"
              />
            </div>
          </div>

          <div>
            <label for="memo" class="block font-semibold mb-2">商品説明</label>
            <textarea
              id="memo"
              name="memo"
              rows="4"
              class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              th:text="${item.memo}"
            ></textarea>
          </div>

          <div>
            <label for="category_id" class="block font-semibold mb-2"
              >カテゴリー</label
            >
            <select
              id="category_id"
              name="category_id"
              class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
              <option
                th:each="cat : ${categories}"
                th:value="${cat.id}"
                th:text="${cat.name}"
                th:selected="${cat.id == item.category.id}"
              ></option>
            </select>
          </div>

          <div class="text-center">
            <button type="submit" class="px-8 py-3 primary-button">
              登録する
            </button>
          </div>
        </form>

        <div class="text-center mt-6">
          <a th:href="@{/mypage}" class="text-sm text-gray-500 hover:underline">
            ← マイページに戻る
          </a>
        </div>
      </div>
    </main>

    <script>
      const imageFile = document.getElementById("imageFile");
      const preview = document.getElementById("preview");
      const originalSrc = preview ? preview.src : "";

      if (preview && originalSrc) {
        preview.classList.remove("hidden");
      }

      imageFile.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.classList.remove("hidden");
          };
          reader.readAsDataURL(file);
        } else {
          preview.src = originalSrc;
          if (!originalSrc) {
            preview.classList.add("hidden");
          }
        }
      });
    </script>
  </body>
</html>
